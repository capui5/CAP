sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/UIComponent","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/ui/core/Fragment"],function(e,t,a,o,n,s,i){"use strict";return e.extend("empreg.controller.View2",{onInit:function(){this.oTable=this.byId("table0");this.oDataModel=this.getOwnerComponent().getModel();this.getView().setModel(this.oDataModel);this.showEmployeesFromNetherlands()},showEmployeesFromNetherlands:function(){var e=new o("country_ID",sap.ui.model.FilterOperator.EQ,"1");this.oTable.bindItems({path:"/Employees",filters:[e],template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{ID}"}),new sap.m.Text({text:"{fname}"}),new sap.m.Text({text:"{lname}"}),new sap.m.Text({text:"{desig}"}),new sap.m.Text({text:"{email}"}),new sap.m.Text({text:"{skills}"}),new sap.m.Text({text:"{country/name}"}),new sap.m.Text({text:"{State}"}),new sap.m.Text({text:"{city}"}),new sap.m.Text({text:"{doj}"}),new sap.m.Text({text:"{yoe} year"}),new sap.m.Text({text:"{gender}"})]})})},getRouter:function(){return a.getRouterFor(this)},onNavBack:function(){var e,a;e=t.getInstance();a=e.getPreviousHash();if(a!==undefined){window.history.go(-1)}else{this.getRouter().navTo("View1",{},true)}},onaddnewemployee:function(){var e=this.getOwnerComponent().getRouter();e.navTo("View5")},onFilter:function(e){var t=[];var a=e.getParameter("query");if(a){t.push(new o("ID",n.EQ,parseInt(a)))}var s=this.byId("table0");var i=s.getBinding("items");i.filter(t)},onDelete:function(){var e=this.getView().byId("table0");var t=e.getSelectedItems()[0];if(!t){sap.m.MessageBox.error("Please select an employee to delete.");return}var a=t.getBindingContext().getObject();var o=a.ID;var n=this;s.confirm("Are you sure you want to delete "+a.fname+" "+a.lname+" record?",{title:"Confirm",onClose:function(t){if(t===sap.m.MessageBox.Action.OK){n.onDeleteSpecificRecord(e,a)}},actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL],emphasizedAction:sap.m.MessageBox.Action.CANCEL,initialFocus:null,textDirection:sap.ui.core.TextDirection.Inherit})},onDeleteSpecificRecord:function(e,t){var a=t.ID;var o=this;$.ajax({url:"../../CatalogService/Employees/"+a,method:"DELETE",success:function(){s.success("Employee deleted successfully.",{onClose:function(){window.location.reload()}});var t=e.getModel("dataModel");var o=t.getProperty("/Employees");for(var n=0;n<o.length;n++){if(o[n].ID===a){o.splice(n,1);t.setProperty("/Employees",o);e.getModel().refresh(true);break}}},error:function(){s.error("Error deleting employee.")}})},onEdit:function(){var e=this.byId("table0");var t=e.getSelectedItems()[0];if(!t){sap.m.MessageBox.error("Please select an employee to Update.");return}var a=t.getBindingContext().getObject();var o=this;if(!this.pDialog){i.load({id:this.getView().getId(),name:"empreg.view.Edit",controller:this}).then(function(e){o.pDialog=e;o.setEmployeeData(a);e.open()}).catch(function(e){s.error("Error loading fragment: "+e)})}else{o.setEmployeeData(a);this.pDialog.open()}},setEmployeeData:function(e){var t=this.getView();var a=t.byId("Id");a.setValue(e.ID);a.setEditable(false);t.byId("fname").setValue(e.fname);t.byId("lname").setValue(e.lname);t.byId("desig").setValue(e.desig);t.byId("email").setValue(e.email);t.byId("skills").setValue(e.skills);var o=t.byId("country");var n=e.country_ID;o.setSelectedKey(n);t.byId("idstate").setValue(e.State);t.byId("idcity").setValue(e.city);t.byId("myDatePicker").setValue(e.doj);t.byId("yoe").setValue(e.yoe);var s=t.byId("genderRadioGroup");var i=e.gender.toLowerCase();if(i==="male"){s.setSelectedIndex(0)}else if(i==="female"){s.setSelectedIndex(1)}},onUpdate:function(){var e=this;var t=this.getView();var a=t.byId("country").getSelectedItem().getKey();var o={Netherlands:1,India:2,Singapore:3};var n=o[a];var i={ID:parseInt(t.byId("Id").getValue()),fname:t.byId("fname").getValue(),lname:t.byId("lname").getValue(),desig:t.byId("desig").getValue(),email:t.byId("email").getValue(),skills:t.byId("skills").getValue(),country_ID:n,State:t.byId("idstate").getValue(),city:t.byId("idcity").getValue(),doj:t.byId("myDatePicker").getValue(),yoe:parseInt(t.byId("yoe").getValue()),gender:t.byId("genderRadioGroup").getSelectedButton().getText()};$.ajax({contentType:"application/json",type:"PATCH",url:"../../CatalogService/Employees("+i.ID+")",dataType:"json",crossDomain:true,data:JSON.stringify(i),success:function(t){e.pDialog.close();s.success("Employee data updated successfully!",{onClose:function(){window.location.reload()}})},error:function(e){s.error("Error while updating employee data")}})},onCancel:function(e){this.byId("openDialog").close()}})});