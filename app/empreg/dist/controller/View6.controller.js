sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/library","sap/m/MessageBox","sap/ui/core/Fragment","../model/formatter"],function(e,t,o,n,a){"use strict";var r=t.URLHelper;return e.extend("empreg.controller.View6",{formatter:a,onInit:function(){this.oList=this.byId("employeelist");this.oDataModel=this.getOwnerComponent().getModel();this.getView().setModel(this.oDataModel);var e=this.getOwnerComponent().getRouter();e.getRoute("View6").attachPatternMatched(this._onRouteMatched,this)},onNavBack:function(){var e=this.getOwnerComponent().getRouter();e.navTo("List")},_onRouteMatched:function(e){var t=e.getParameters();var o=t.arguments.SEmployeeId;var n=this.getView();var a=n.getModel("MainModel");n.bindElement({path:"/Employees/"+o,model:"MainModel"})},onDelete:function(){var e=this.getView();var t=e.byId("employeePanel");var o=e.byId("employeelist");var n=this;if(t){var a=t.getBindingContext("MainModel");sap.m.MessageBox.confirm("Are you sure you want to delete this employee?",{title:"Confirm Deletion",onClose:function(e){if(e===sap.m.MessageBox.Action.OK){a.delete("$direct").then(function(){sap.m.MessageBox.success("Employee deleted successfully.",{onClose:function(){var e=n.getOwnerComponent().getRouter();e.navTo("View1");setTimeout(function(){window.location.reload()},10)}})}).catch(function(e){sap.m.MessageBox.error("Error deleting employee.")})}}})}},formatPhoto:function(e){console.log("Employee ID:",e);if(e){var t="images/"+e+".jpg";console.log("Employee Image URL:",t);var o=new Image;o.src=t;return new Promise(function(e,n){o.onload=function(){console.log("Image loaded successfully");e(t)};o.onerror=function(){console.error("Image not found, using default");e("images/default.jpg")}})}else{console.log("Employee ID not provided, using default");return"images/default.jpg"}},onEdit:function(){var e=this.getView();var t=this.byId("editDialog");if(!t){n.load({id:e.getId(),name:"empreg.view.Edit",controller:this}).then(function(t){e.addDependent(t);t.attachAfterClose(function(){t.destroy()});t.open()}).catch(function(e){o.error("Error loading fragment: "+e)})}else{t.open()}var a=e.getModel("MainModel");console.log(a.getData())},onUpdate:function(){const e=this.getView();const t=e.byId("country").getSelectedItem().getKey();const o={Netherlands:1,India:2,Singapore:3};const n=o[t];const a=e.byId("leave").getSelectedKey()==="0";const r=e.byId("Id").getValue();if(!/^\d+$/.test(r)){sap.m.MessageBox.error("Invalid Employee ID. Please enter a valid number.");return}const s=y(e.byId("myDatePicker").getDateValue());const l=parseInt(e.byId("yoe").getValue());const i=e.byId("phonenumber");const d=i.getValue().replace(/,/g,"");const c=d?parseFloat(d.replace(/,/g,"")):null;if(isNaN(c)){sap.m.MessageBox.error("Invalid Phone Number. Please enter a valid number.");return}const g=e.byId("genderDropdown");const u=g.getSelectedKey();let m;if(u==="Male"){m="Male"}else if(u==="Female"){m="Female"}else{sap.m.MessageBox.error("Please select a valid gender.");return}const p={ID:parseInt(r),fname:e.byId("fname").getValue(),lname:e.byId("lname").getValue(),desig:e.byId("desig").getValue(),email:e.byId("email").getValue(),skills:e.byId("skills").getValue(),country_ID:n,State:e.byId("idstate").getValue(),city:e.byId("idcity").getValue(),doj:s,yoe:l,Phno:c!==null?c.toString():null,reportingPerson:e.byId("reportingPerson").getValue(),gender:m,leave:a};fetch(`./CatalogService/Employees(${p.ID})`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(e=>{if(e.ok){sap.m.MessageBox.success("Employee Details Updated successfully.",{onClose:function(){window.location.reload()}})}else{throw new Error("Error updating employee data")}}).catch(function(e){sap.m.MessageBox.error(e.message)});function y(e){const t=e.getFullYear();const o=String(e.getMonth()+1).padStart(2,"0");const n=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${n}`}},onCancel:function(e){this.byId("openDialog").close()}})});