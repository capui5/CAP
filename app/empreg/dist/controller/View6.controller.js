sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/library","sap/m/MessageBox","sap/ui/core/Fragment","../model/formatter"],function(e,t,o,n,r){"use strict";var a=t.URLHelper;return e.extend("empreg.controller.View6",{formatter:r,onInit:function(){this.oList=this.byId("employeelist");this.oDataModel=this.getOwnerComponent().getModel();this.getView().setModel(this.oDataModel);var e=this.getOwnerComponent().getRouter();e.getRoute("View6").attachPatternMatched(this._onRouteMatched,this)},onNavBack:function(){var e=this.getOwnerComponent().getRouter();e.navTo("List")},_onRouteMatched:function(e){var t=e.getParameters();var o=t.arguments.SEmployeeId;var n=this.getView();var r=n.getModel("MainModel");n.bindElement({path:"/Employees/"+o,model:"MainModel"})},handleEmailPress:function(e){var t="recipient@example.com";var o="Info Request";var n="Hello, I would like to request some information.";var r="mailto:"+t+"?subject="+encodeURIComponent(o)+"&body="+encodeURIComponent(n);window.location.href=r},onDelete:function(){console.log("Delete button clicked");var e=this.getView();var t=e.getBindingContext("MainModel");if(t){var n=t.getProperty("ID");o.confirm("Are you sure you want to delete this employee?",{title:"Confirm Deletion",onClose:function(n){if(n===o.Action.OK){t.delete("$direct").then(function(){o.success("Employee deleted successfully.",{onClose:function(){var t=sap.ui.core.UIComponent.getRouterFor(e);t.navTo("View1");setTimeout(function(){window.location.reload()},10)}})}).catch(function(e){console.error("Error deleting employee:",e);o.error("Error deleting employee.")})}}})}else{console.error("No binding context found.")}},formatPhoto:function(e,t){console.log("Employee ID:",e);console.log("Gender received:",t);var o="images/default-boy.jpg";var n="images/default-girl.jpg";function r(e){return new Promise(function(t,o){var n=new Image;n.src=e;n.onload=function(){console.log("Image loaded successfully");t(e)};n.onerror=function(){console.error("Image not found, using default");t(null)}})}if(e){var a="images/"+e+".jpg";console.log("Employee Image URL:",a);return r(a).then(function(e){return e||(t==="Male"?o:n)})}return t==="Male"?o:n},onEdit:function(){var e=this.getView();var t=this.byId("editDialog");if(!t){n.load({id:e.getId(),name:"empreg.view.Edit",controller:this}).then(function(t){e.addDependent(t);t.attachAfterClose(function(){t.destroy()});t.open()}).catch(function(e){o.error("Error loading fragment: "+e)})}else{t.open()}var r=e.getModel("MainModel");console.log(r.getData())},onUpdate:function(){const e=this.getView();const t=e.byId("country").getSelectedItem().getKey();const o={Netherlands:1,India:2,Singapore:3};const n=o[t];const r=e.byId("leave").getSelectedKey()==="0";const a=e.byId("Id").getValue();if(!/^\d+$/.test(a)){sap.m.MessageBox.error("Invalid Employee ID. Please enter a valid number.");return}const l=f(e.byId("myDatePicker").getDateValue());const i=parseInt(e.byId("yoe").getValue());const s=e.byId("phonenumber");const c=s.getValue().replace(/,/g,"");const d=c?parseFloat(c.replace(/,/g,"")):null;if(isNaN(d)){sap.m.MessageBox.error("Invalid Phone Number. Please enter a valid number.");return}const u=e.byId("genderDropdown");const g=u.getSelectedKey();let m;if(g==="Male"){m="Male"}else if(g==="Female"){m="Female"}else{sap.m.MessageBox.error("Please select a valid gender.");return}const p={ID:parseInt(a),fname:e.byId("fname").getValue(),lname:e.byId("lname").getValue(),desig:e.byId("desig").getValue(),email:e.byId("email").getValue(),skills:e.byId("skills").getValue().toUpperCase(),country_ID:n,State:e.byId("idstate").getValue(),city:e.byId("idcity").getValue(),doj:l,yoe:i,Phno:d!==null?d.toString():null,reportingPerson:e.byId("reportingPerson").getValue(),gender:m,leave:r};fetch(`./CatalogService/Employees(${p.ID})`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(e=>{if(e.ok){sap.m.MessageBox.success("Employee Details Updated successfully.",{onClose:function(){window.location.reload()}})}else{throw new Error("Error updating employee data")}}).catch(function(e){sap.m.MessageBox.error(e.message)});function f(e){const t=e.getFullYear();const o=String(e.getMonth()+1).padStart(2,"0");const n=String(e.getDate()).padStart(2,"0");return`${t}-${o}-${n}`}},onCancel:function(e){this.byId("openDialog").close()}})});